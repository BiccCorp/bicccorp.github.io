<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Quiz SÅ‚Ã³wek - BiccCorp Blog</title>
  <link rel="stylesheet" href="../style.css" />
  <script src="../fade.js"></script>
  <style>
    #quiz-root {
      max-width: 520px;
      margin: 0 auto;
      padding: 1.5rem 0 2rem;
    }

    #lang-screen { text-align: center; }
    #lang-screen h2 {
      font-size: 1rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      opacity: 0.5;
      margin-bottom: 1.5rem;
    }

    .lang-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.6rem;
      margin-bottom: 1.5rem;
    }
    @media (max-width: 420px) { .lang-grid { grid-template-columns: repeat(2,1fr); } }

    .lang-btn {
      background: transparent;
      border: 1px solid currentColor;
      color: inherit;
      font: inherit;
      font-size: 0.82rem;
      padding: 0.6rem 0.5rem;
      cursor: pointer;
      letter-spacing: 0.06em;
      transition: opacity 0.15s, background 0.15s;
      display: flex; flex-direction: column;
      align-items: center; gap: 0.25rem;
    }
    .lang-btn:hover { opacity: 0.65; }
    .lang-btn.selected { background: currentColor; color: var(--bg, #0a0a0f); }
    .lang-flag { font-size: 1.4rem; }

    .diff-row {
      display: flex; gap: 0.5rem;
      justify-content: center;
      margin-bottom: 1.5rem;
      align-items: center;
    }
    .diff-label { font-size: 0.78rem; opacity: 0.4; letter-spacing: 0.08em; }
    .diff-btn {
      background: transparent; border: 1px solid currentColor;
      color: inherit; font: inherit; font-size: 0.78rem;
      padding: 0.35rem 0.9rem; cursor: pointer;
      letter-spacing: 0.08em; opacity: 0.45; transition: opacity 0.15s;
    }
    .diff-btn:hover { opacity: 0.8; }
    .diff-btn.active { opacity: 1; border-width: 2px; }

    .start-btn {
      background: transparent; border: 1px solid currentColor;
      color: inherit; font: inherit; font-size: 0.85rem;
      padding: 0.65rem 2.5rem; cursor: pointer;
      text-transform: uppercase; letter-spacing: 0.12em;
      transition: opacity 0.2s;
    }
    .start-btn:hover { opacity: 0.6; }
    .start-btn:disabled { opacity: 0.2; cursor: not-allowed; }

    #quiz-screen { display: none; }

    .quiz-meta {
      display: flex; justify-content: space-between;
      align-items: center; font-size: 0.75rem;
      opacity: 0.5; letter-spacing: 0.08em;
      margin-bottom: 1.2rem; text-transform: uppercase;
      flex-wrap: wrap; gap: 0.3rem;
    }
    .quiz-meta button {
      background: transparent; border: none; color: inherit;
      font: inherit; font-size: 0.72rem; cursor: pointer;
      opacity: 0.7; padding: 0; letter-spacing: 0.08em;
    }
    .quiz-meta button:hover { opacity: 1; }

    .score-bar {
      display: flex; gap: 0.4rem;
      align-items: center; margin-bottom: 1.5rem;
    }
    .score-seg {
      width: 18px; height: 6px; border: 1px solid currentColor;
      opacity: 0.2; transition: opacity 0.3s, background 0.3s;
    }
    .score-seg.correct { background: currentColor; opacity: 1; }
    .score-seg.wrong   { border-color: #e74c3c; opacity: 1; }
    .score-label { margin-left: auto; font-size: 0.78rem; opacity: 0.6; }

    .word-card {
      border: 1px solid currentColor;
      padding: 1.8rem 1.5rem; margin-bottom: 1.2rem;
      text-align: center; position: relative;
      min-height: 110px; display: flex; flex-direction: column;
      align-items: center; justify-content: center; gap: 0.4rem;
    }
    .word-lang-tag {
      font-size: 0.65rem; letter-spacing: 0.15em;
      text-transform: uppercase; opacity: 0.4;
      position: absolute; top: 0.5rem; left: 0.8rem;
    }
    .word-category {
      font-size: 0.65rem; letter-spacing: 0.1em;
      text-transform: uppercase; opacity: 0.3;
      position: absolute; top: 0.5rem; right: 0.8rem;
    }
    .word-main {
      font-size: 2rem; font-weight: bold;
      letter-spacing: 0.03em; line-height: 1.1;
    }
    .word-loading {
      font-size: 0.85rem; opacity: 0.4;
      letter-spacing: 0.12em;
      animation: pulse 1.2s ease-in-out infinite;
    }
    @keyframes pulse { 0%,100%{opacity:0.2} 50%{opacity:0.6} }

    .answers {
      display: grid; grid-template-columns: 1fr 1fr;
      gap: 0.6rem; margin-bottom: 1rem;
    }
    .ans-btn {
      background: transparent; border: 1px solid currentColor;
      color: inherit; font: inherit; font-size: 0.88rem;
      padding: 0.75rem 0.6rem; cursor: pointer;
      text-align: left; letter-spacing: 0.03em;
      transition: opacity 0.15s, border-color 0.2s, color 0.2s;
      display: flex; align-items: center; gap: 0.5rem;
      line-height: 1.3;
    }
    .ans-btn:hover:not(:disabled) { opacity: 0.7; }
    .ans-btn:disabled { cursor: default; }
    .ans-letter {
      font-size: 0.7rem; letter-spacing: 0.1em;
      opacity: 0.45; min-width: 1.2em; font-weight: bold;
    }
    .ans-btn.correct { border-color: #2ecc71; color: #2ecc71; }
    .ans-btn.correct .ans-letter { opacity: 1; }
    .ans-btn.wrong { border-color: #e74c3c; color: #e74c3c; opacity: 0.7; }
    .ans-btn.reveal { border-color: #2ecc71; color: #2ecc71; opacity: 0.55; }

    .feedback {
      font-size: 0.8rem; letter-spacing: 0.06em;
      text-align: center; min-height: 1.4em;
      margin-bottom: 0.6rem; font-style: italic;
      opacity: 0; transition: opacity 0.3s;
    }
    .feedback.show { opacity: 0.8; }
    .feedback.ok   { color: #2ecc71; }
    .feedback.fail { color: #e74c3c; }

    .next-btn {
      display: block; width: 100%;
      background: transparent; border: 1px solid currentColor;
      color: inherit; font: inherit; font-size: 0.82rem;
      padding: 0.65rem; cursor: pointer;
      text-transform: uppercase; letter-spacing: 0.12em;
      opacity: 0; pointer-events: none; transition: opacity 0.3s;
    }
    .next-btn.show { opacity: 1; pointer-events: all; }
    .next-btn:hover { opacity: 0.65 !important; }

    .streak-badge {
      text-align: center; font-size: 0.78rem;
      letter-spacing: 0.08em; opacity: 0;
      transition: opacity 0.4s; margin-top: 0.4rem;
    }
    .streak-badge.show { opacity: 0.7; }

    .err-box {
      border: 1px solid #e74c3c; border-left-width: 3px;
      padding: 0.7rem 1rem; font-size: 0.78rem;
      color: #e74c3c; margin-bottom: 1rem;
      display: none; line-height: 1.7;
    }
    .err-box.show { display: block; }

    .info-note {
      font-size: 0.72rem; opacity: 0.4;
      text-align: center; margin-top: 1rem;
      letter-spacing: 0.05em; line-height: 1.7;
    }
  </style>
</head>
<body class="dark">
  <header>
    <h1>Quiz SÅ‚Ã³wek</h1>
    <nav>
      <a href="../index.html">Strona gÅ‚Ã³wna</a>
      <a href="../o-mnie.html">O mnie</a>
      <a href="../galeria.html">Galeria</a>
      <a href="../wpisy.html">Wpisy</a>
    </nav>
  </header>

  <main style="max-width: 700px; padding: 1rem;">
    <article>
      <p><em>Data publikacji: 2025-06-07</em></p>
      <p>Wybierz jÄ™zyk i tÅ‚umacz sÅ‚owa na polski. Quiz korzysta z darmowego API tÅ‚umaczeÅ„ â€” bez rejestracji, bez klucza.</p>

      <div id="quiz-root">

        <div id="lang-screen">
          <h2>Wybierz jÄ™zyk</h2>
          <div class="lang-grid" id="lang-grid"></div>
          <div class="diff-row">
            <span class="diff-label">Poziom:</span>
            <button class="diff-btn active" data-diff="easy"   onclick="setDiff(this)">Åatwy</button>
            <button class="diff-btn"        data-diff="medium" onclick="setDiff(this)">Åšredni</button>
            <button class="diff-btn"        data-diff="hard"   onclick="setDiff(this)">Trudny</button>
          </div>
          <button class="start-btn" id="start-btn" onclick="startQuiz()" disabled>Rozpocznij â†’</button>
          <div class="info-note">TÅ‚umaczenia: MyMemory API (darmowy, bez klucza)</div>
        </div>

        <div id="quiz-screen">
          <div class="quiz-meta">
            <span id="quiz-lang-label"></span>
            <span id="quiz-diff-label"></span>
            <button onclick="goBack()">â† zmieÅ„ jÄ™zyk</button>
          </div>
          <div class="score-bar" id="score-bar">
            <span class="score-label" id="score-label">0 / 0</span>
          </div>
          <div class="err-box" id="err-box"></div>
          <div class="word-card" id="word-card">
            <div class="word-loading">ÅadujÄ™<span id="load-dots">...</span></div>
          </div>
          <div class="answers" id="answers"></div>
          <div class="feedback" id="feedback"></div>
          <button class="next-btn" id="next-btn" onclick="nextQuestion()">NastÄ™pne sÅ‚owo â†’</button>
          <div class="streak-badge" id="streak-badge"></div>
        </div>

      </div>
    </article>
  </main>

  <footer><p>Â© 2025 BiccCorp</p></footer>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  WORD DATABASE
//  Organized by language â†’ difficulty â†’ category â†’ words
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const WORD_DB = {
  en: {
    easy: [
      { cat:'jedzenie',   words:['apple','bread','milk','egg','rice','soup','cake','fish','meat','water','juice','tea','coffee','cheese','butter'] },
      { cat:'kolory',     words:['red','blue','green','yellow','black','white','pink','orange','purple','brown','gray','gold'] },
      { cat:'liczby',     words:['one','two','three','four','five','six','seven','eight','nine','ten','hundred','thousand'] },
      { cat:'rodzina',    words:['mother','father','sister','brother','grandmother','grandfather','son','daughter','wife','husband','baby','child'] },
      { cat:'ciaÅ‚o',      words:['hand','eye','nose','mouth','ear','head','foot','arm','leg','hair','heart','tooth'] },
      { cat:'dom',        words:['door','window','table','chair','bed','kitchen','bathroom','garden','wall','floor','roof','lamp'] },
    ],
    medium: [
      { cat:'czasowniki', words:['run','jump','sleep','eat','drink','write','read','speak','listen','work','travel','learn','forget','remember','laugh'] },
      { cat:'przymiotniki',words:['happy','sad','angry','tired','hungry','strong','weak','fast','slow','big','small','young','old','beautiful','ugly'] },
      { cat:'pogoda',     words:['rain','snow','wind','cloud','storm','fog','thunder','sunshine','frost','flood','drought','rainbow'] },
      { cat:'miasto',     words:['street','bridge','hospital','school','market','library','station','airport','museum','hotel','park','church'] },
      { cat:'czas',       words:['morning','evening','midnight','yesterday','tomorrow','weekend','century','moment','decade','season','holiday','birthday'] },
    ],
    hard: [
      { cat:'idiomy',     words:['nevertheless','furthermore','consequently','approximately','throughout','circumstance','acknowledge','perspective','phenomenon','consciousness'] },
      { cat:'abstrakcja', words:['freedom','justice','equality','democracy','philosophy','ambition','integrity','resilience','empathy','nostalgia','melancholy','euphoria'] },
      { cat:'nauka',      words:['hypothesis','molecule','chromosome','algorithm','photosynthesis','thermodynamics','electromagnetic','metabolism','ecosystem','relativity'] },
    ],
  },
  de: {
    easy: [
      { cat:'jedzenie',   words:['Brot','Milch','KÃ¤se','Apfel','Wasser','Kaffee','Kuchen','Fisch','Ei','Suppe','Butter','Salz'] },
      { cat:'kolory',     words:['rot','blau','grÃ¼n','gelb','schwarz','weiÃŸ','rosa','lila','orange','braun','grau','gold'] },
      { cat:'rodzina',    words:['Mutter','Vater','Bruder','Schwester','Oma','Opa','Sohn','Tochter','Baby','Kind','Mann','Frau'] },
      { cat:'dom',        words:['TÃ¼r','Fenster','Tisch','Stuhl','Bett','KÃ¼che','Garten','Wand','Boden','Dach','Lampe','Treppe'] },
    ],
    medium: [
      { cat:'czasowniki', words:['laufen','schlafen','essen','trinken','schreiben','lesen','sprechen','arbeiten','lernen','reisen','lachen','vergessen'] },
      { cat:'przymiotniki',words:['glÃ¼cklich','traurig','mÃ¼de','hungrig','stark','schnell','langsam','jung','alt','schÃ¶n','klein','groÃŸ'] },
      { cat:'miasto',     words:['StraÃŸe','BrÃ¼cke','Schule','Markt','Bahnhof','Flughafen','Museum','Hotel','Park','Kirche','Krankenhaus','Bibliothek'] },
    ],
    hard: [
      { cat:'abstrakcja', words:['Freiheit','Gerechtigkeit','Gleichheit','Sehnsucht','Weltanschauung','Schadenfreude','Fernweh','Verschlimmbessern','Torschlusspanik','Drachenfutter'] },
      { cat:'nauka',      words:['MolekÃ¼l','Chromosom','Algorithmus','Photosynthese','Thermodynamik','Metabolismus','Ã–kosystem','RelativitÃ¤t','Hypothese','Elektromagnetismus'] },
    ],
  },
  es: {
    easy: [
      { cat:'jedzenie',   words:['pan','leche','queso','manzana','agua','cafÃ©','pastel','pescado','huevo','sopa','mantequilla','sal'] },
      { cat:'kolory',     words:['rojo','azul','verde','amarillo','negro','blanco','rosa','naranja','morado','marrÃ³n','gris','dorado'] },
      { cat:'rodzina',    words:['madre','padre','hermano','hermana','abuela','abuelo','hijo','hija','bebÃ©','niÃ±o','esposo','esposa'] },
      { cat:'dom',        words:['puerta','ventana','mesa','silla','cama','cocina','jardÃ­n','pared','suelo','techo','lÃ¡mpara','escalera'] },
    ],
    medium: [
      { cat:'czasowniki', words:['correr','dormir','comer','beber','escribir','leer','hablar','trabajar','aprender','viajar','reÃ­r','olvidar'] },
      { cat:'przymiotniki',words:['feliz','triste','cansado','hambriento','fuerte','rÃ¡pido','lento','joven','viejo','hermoso','pequeÃ±o','grande'] },
      { cat:'miasto',     words:['calle','puente','escuela','mercado','estaciÃ³n','aeropuerto','museo','hotel','parque','iglesia','hospital','biblioteca'] },
    ],
    hard: [
      { cat:'abstrakcja', words:['libertad','justicia','igualdad','democracia','filosofÃ­a','ambiciÃ³n','integridad','resiliencia','empatÃ­a','nostalgia','melancolÃ­a','euforia'] },
      { cat:'idiomy',     words:['madrugada','aÃ±oranza','sobremesa','mariposa','desvelado','trasnochar','madrugar','tutear','pordiosear','menospreciar'] },
    ],
  },
  fr: {
    easy: [
      { cat:'jedzenie',   words:['pain','lait','fromage','pomme','eau','cafÃ©','gÃ¢teau','poisson','oeuf','soupe','beurre','sel'] },
      { cat:'kolory',     words:['rouge','bleu','vert','jaune','noir','blanc','rose','orange','violet','marron','gris','dorÃ©'] },
      { cat:'rodzina',    words:['mÃ¨re','pÃ¨re','frÃ¨re','soeur','grand-mÃ¨re','grand-pÃ¨re','fils','fille','bÃ©bÃ©','enfant','mari','femme'] },
      { cat:'dom',        words:['porte','fenÃªtre','table','chaise','lit','cuisine','jardin','mur','sol','toit','lampe','escalier'] },
    ],
    medium: [
      { cat:'czasowniki', words:['courir','dormir','manger','boire','Ã©crire','lire','parler','travailler','apprendre','voyager','rire','oublier'] },
      { cat:'przymiotniki',words:['heureux','triste','fatiguÃ©','affamÃ©','fort','rapide','lent','jeune','vieux','beau','petit','grand'] },
      { cat:'miasto',     words:['rue','pont','Ã©cole','marchÃ©','gare','aÃ©roport','musÃ©e','hÃ´tel','parc','Ã©glise','hÃ´pital','bibliothÃ¨que'] },
    ],
    hard: [
      { cat:'abstrakcja', words:['libertÃ©','justice','Ã©galitÃ©','dÃ©mocratie','philosophie','ambition','intÃ©gritÃ©','rÃ©silience','empathie','nostalgie','mÃ©lancolie','euphorie'] },
      { cat:'idiomy',     words:['dÃ©paysement','flÃ¢ner','soulager','se souvenir','Ã©panouissement','bouleversement','dÃ©brouillard','insouciance','nonchalance','bienveillance'] },
    ],
  },
  it: {
    easy: [
      { cat:'jedzenie',   words:['pane','latte','formaggio','mela','acqua','caffÃ¨','torta','pesce','uovo','zuppa','burro','sale'] },
      { cat:'kolory',     words:['rosso','blu','verde','giallo','nero','bianco','rosa','arancione','viola','marrone','grigio','dorato'] },
      { cat:'rodzina',    words:['madre','padre','fratello','sorella','nonna','nonno','figlio','figlia','bambino','marito','moglie','bebÃ¨'] },
    ],
    medium: [
      { cat:'czasowniki', words:['correre','dormire','mangiare','bere','scrivere','leggere','parlare','lavorare','imparare','viaggiare','ridere','dimenticare'] },
      { cat:'przymiotniki',words:['felice','triste','stanco','affamato','forte','veloce','lento','giovane','vecchio','bello','piccolo','grande'] },
    ],
    hard: [
      { cat:'abstrakcja', words:['libertÃ ','giustizia','uguaglianza','democrazia','filosofia','ambizione','integritÃ ','resilienza','empatia','nostalgia','malinconia','euforia'] },
    ],
  },
  pt: {
    easy: [
      { cat:'jedzenie',   words:['pÃ£o','leite','queijo','maÃ§Ã£','Ã¡gua','cafÃ©','bolo','peixe','ovo','sopa','manteiga','sal'] },
      { cat:'kolory',     words:['vermelho','azul','verde','amarelo','preto','branco','rosa','laranja','roxo','marrom','cinza','dourado'] },
      { cat:'rodzina',    words:['mÃ£e','pai','irmÃ£o','irmÃ£','avÃ³','avÃ´','filho','filha','bebÃª','crianÃ§a','marido','esposa'] },
    ],
    medium: [
      { cat:'czasowniki', words:['correr','dormir','comer','beber','escrever','ler','falar','trabalhar','aprender','viajar','rir','esquecer'] },
      { cat:'przymiotniki',words:['feliz','triste','cansado','faminto','forte','rÃ¡pido','lento','jovem','velho','bonito','pequeno','grande'] },
    ],
    hard: [
      { cat:'abstrakcja', words:['liberdade','justiÃ§a','igualdade','democracia','filosofia','ambiÃ§Ã£o','integridade','resiliÃªncia','empatia','saudade','melancolia','euforia'] },
    ],
  },
  ru: {
    easy: [
      { cat:'jedzenie',   words:['Ñ…Ğ»ĞµĞ±','Ğ¼Ğ¾Ğ»Ğ¾ĞºĞ¾','ÑÑ‹Ñ€','ÑĞ±Ğ»Ğ¾ĞºĞ¾','Ğ²Ğ¾Ğ´Ğ°','ĞºĞ¾Ñ„Ğµ','Ñ‚Ğ¾Ñ€Ñ‚','Ñ€Ñ‹Ğ±Ğ°','ÑĞ¹Ñ†Ğ¾','ÑÑƒĞ¿','Ğ¼Ğ°ÑĞ»Ğ¾','ÑĞ¾Ğ»ÑŒ'] },
      { cat:'kolory',     words:['ĞºÑ€Ğ°ÑĞ½Ñ‹Ğ¹','ÑĞ¸Ğ½Ğ¸Ğ¹','Ğ·ĞµĞ»Ñ‘Ğ½Ñ‹Ğ¹','Ğ¶Ñ‘Ğ»Ñ‚Ñ‹Ğ¹','Ñ‡Ñ‘Ñ€Ğ½Ñ‹Ğ¹','Ğ±ĞµĞ»Ñ‹Ğ¹','Ñ€Ğ¾Ğ·Ğ¾Ğ²Ñ‹Ğ¹','Ğ¾Ñ€Ğ°Ğ½Ğ¶ĞµĞ²Ñ‹Ğ¹','Ñ„Ğ¸Ğ¾Ğ»ĞµÑ‚Ğ¾Ğ²Ñ‹Ğ¹','ĞºĞ¾Ñ€Ğ¸Ñ‡Ğ½ĞµĞ²Ñ‹Ğ¹','ÑĞµÑ€Ñ‹Ğ¹','Ğ·Ğ¾Ğ»Ğ¾Ñ‚Ğ¾Ğ¹'] },
      { cat:'rodzina',    words:['Ğ¼Ğ°Ñ‚ÑŒ','Ğ¾Ñ‚ĞµÑ†','Ğ±Ñ€Ğ°Ñ‚','ÑĞµÑÑ‚Ñ€Ğ°','Ğ±Ğ°Ğ±ÑƒÑˆĞºĞ°','Ğ´ĞµĞ´ÑƒÑˆĞºĞ°','ÑÑ‹Ğ½','Ğ´Ğ¾Ñ‡ÑŒ','Ñ€ĞµĞ±Ñ‘Ğ½Ğ¾Ğº','Ğ¼ÑƒĞ¶','Ğ¶ĞµĞ½Ğ°','ÑĞµĞ¼ÑŒÑ'] },
    ],
    medium: [
      { cat:'czasowniki', words:['Ğ±ĞµĞ¶Ğ°Ñ‚ÑŒ','ÑĞ¿Ğ°Ñ‚ÑŒ','ĞµÑÑ‚ÑŒ','Ğ¿Ğ¸Ñ‚ÑŒ','Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ','Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ','Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ¸Ñ‚ÑŒ','Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ','ÑƒÑ‡Ğ¸Ñ‚ÑŒÑÑ','Ğ¿ÑƒÑ‚ĞµÑˆĞµÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ñ‚ÑŒ','ÑĞ¼ĞµÑÑ‚ÑŒÑÑ','Ğ·Ğ°Ğ±Ñ‹Ğ²Ğ°Ñ‚ÑŒ'] },
      { cat:'przymiotniki',words:['ÑÑ‡Ğ°ÑÑ‚Ğ»Ğ¸Ğ²Ñ‹Ğ¹','Ğ³Ñ€ÑƒÑÑ‚Ğ½Ñ‹Ğ¹','ÑƒÑÑ‚Ğ°Ğ»Ñ‹Ğ¹','Ğ³Ğ¾Ğ»Ğ¾Ğ´Ğ½Ñ‹Ğ¹','ÑĞ¸Ğ»ÑŒĞ½Ñ‹Ğ¹','Ğ±Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹','Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ñ‹Ğ¹','Ğ¼Ğ¾Ğ»Ğ¾Ğ´Ğ¾Ğ¹','ÑÑ‚Ğ°Ñ€Ñ‹Ğ¹','ĞºÑ€Ğ°ÑĞ¸Ğ²Ñ‹Ğ¹','Ğ¼Ğ°Ğ»ĞµĞ½ÑŒĞºĞ¸Ğ¹','Ğ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹'] },
    ],
    hard: [
      { cat:'abstrakcja', words:['ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ğ°','ÑĞ¿Ñ€Ğ°Ğ²ĞµĞ´Ğ»Ğ¸Ğ²Ğ¾ÑÑ‚ÑŒ','Ñ€Ğ°Ğ²ĞµĞ½ÑÑ‚Ğ²Ğ¾','Ğ´ĞµĞ¼Ğ¾ĞºÑ€Ğ°Ñ‚Ğ¸Ñ','Ñ„Ğ¸Ğ»Ğ¾ÑĞ¾Ñ„Ğ¸Ñ','Ğ°Ğ¼Ğ±Ğ¸Ñ†Ğ¸Ñ','Ñ‡ĞµÑÑ‚Ğ½Ğ¾ÑÑ‚ÑŒ','ÑÑ‚Ğ¾Ğ¹ĞºĞ¾ÑÑ‚ÑŒ','ÑĞ¾Ñ‡ÑƒĞ²ÑÑ‚Ğ²Ğ¸Ğµ','Ğ½Ğ¾ÑÑ‚Ğ°Ğ»ÑŒĞ³Ğ¸Ñ','Ğ¼ĞµĞ»Ğ°Ğ½Ñ…Ğ¾Ğ»Ğ¸Ñ','ÑĞ¹Ñ„Ğ¾Ñ€Ğ¸Ñ'] },
    ],
  },
  ja: {
    easy: [
      { cat:'jedzenie',   words:['ãƒ‘ãƒ³','ç‰›ä¹³','ã‚Šã‚“ã”','æ°´','ã‚³ãƒ¼ãƒ’ãƒ¼','ã‚±ãƒ¼ã‚­','é­š','åµ','ã‚¹ãƒ¼ãƒ—','ãƒã‚¿ãƒ¼','å¡©','ãŠèŒ¶'] },
      { cat:'kolory',     words:['èµ¤','é’','ç·‘','é»„è‰²','é»’','ç™½','ãƒ”ãƒ³ã‚¯','ã‚ªãƒ¬ãƒ³ã‚¸','ç´«','èŒ¶è‰²','ç°è‰²','é‡‘è‰²'] },
      { cat:'liczby',     words:['ä¸€','äºŒ','ä¸‰','å››','äº”','å…­','ä¸ƒ','å…«','ä¹','å','ç™¾','åƒ'] },
      { cat:'rodzina',    words:['æ¯','çˆ¶','å…„','å§‰','å¼Ÿ','å¦¹','ç¥–æ¯','ç¥–çˆ¶','æ¯å­','å¨˜','èµ¤ã¡ã‚ƒã‚“','å­ä¾›'] },
    ],
    medium: [
      { cat:'czasowniki', words:['èµ°ã‚‹','å¯ã‚‹','é£Ÿã¹ã‚‹','é£²ã‚€','æ›¸ã','èª­ã‚€','è©±ã™','åƒã','å­¦ã¶','æ—…è¡Œã™ã‚‹','ç¬‘ã†','å¿˜ã‚Œã‚‹'] },
      { cat:'przymiotniki',words:['å¬‰ã—ã„','æ‚²ã—ã„','ç–²ã‚ŒãŸ','ç©ºè…¹','å¼·ã„','é€Ÿã„','é…ã„','è‹¥ã„','å¤ã„','ç¾ã—ã„','å°ã•ã„','å¤§ãã„'] },
    ],
    hard: [
      { cat:'abstrakcja', words:['è‡ªç”±','æ­£ç¾©','å¹³ç­‰','æ°‘ä¸»ä¸»ç¾©','å“²å­¦','é‡å¿ƒ','èª å®Ÿ','å›å¾©åŠ›','å…±æ„Ÿ','éƒ·æ„','æ†‚é¬±','å¹¸ç¦æ„Ÿ'] },
      { cat:'kultura',    words:['ä¾˜ã³å¯‚ã³','æœ¨æ¼ã‚Œæ—¥','æœ¨æ¼ã‚Œæ—¥','ç‰©ã®å“€ã‚Œ','é–“','ç©ºæ°—','ç¸','ç¾©ç†','æ¥','èª‡ã‚Š'] },
    ],
  },
  zh: {
    easy: [
      { cat:'jedzenie',   words:['é¢åŒ…','ç‰›å¥¶','è‹¹æœ','æ°´','å’–å•¡','è›‹ç³•','é±¼','é¸¡è›‹','æ±¤','é»„æ²¹','ç›','èŒ¶'] },
      { cat:'kolory',     words:['çº¢è‰²','è“è‰²','ç»¿è‰²','é»„è‰²','é»‘è‰²','ç™½è‰²','ç²‰è‰²','æ©™è‰²','ç´«è‰²','æ£•è‰²','ç°è‰²','é‡‘è‰²'] },
      { cat:'liczby',     words:['ä¸€','äºŒ','ä¸‰','å››','äº”','å…­','ä¸ƒ','å…«','ä¹','å','ç™¾','åƒ'] },
      { cat:'rodzina',    words:['å¦ˆå¦ˆ','çˆ¸çˆ¸','å“¥å“¥','å§å§','å¼Ÿå¼Ÿ','å¦¹å¦¹','å¥¶å¥¶','çˆ·çˆ·','å„¿å­','å¥³å„¿','å©´å„¿','å­©å­'] },
    ],
    medium: [
      { cat:'czasowniki', words:['è·‘æ­¥','ç¡è§‰','åƒé¥­','å–æ°´','å†™å­—','è¯»ä¹¦','è¯´è¯','å·¥ä½œ','å­¦ä¹ ','æ—…è¡Œ','ç¬‘','å¿˜è®°'] },
      { cat:'przymiotniki',words:['å¿«ä¹','æ‚²ä¼¤','ç–²æƒ«','é¥¥é¥¿','å¼ºå£®','å¿«é€Ÿ','ç¼“æ…¢','å¹´è½»','å¹´è€','ç¾ä¸½','å°','å¤§'] },
    ],
    hard: [
      { cat:'abstrakcja', words:['è‡ªç”±','æ­£ä¹‰','å¹³ç­‰','æ°‘ä¸»','å“²å­¦','é‡å¿ƒ','è¯šå®','éŸ§æ€§','åŒç†å¿ƒ','ä¹¡æ„','å¿§éƒ','å¹¸ç¦'] },
    ],
  },
  ko: {
    easy: [
      { cat:'jedzenie',   words:['ë¹µ','ìš°ìœ ','ì‚¬ê³¼','ë¬¼','ì»¤í”¼','ì¼€ì´í¬','ìƒì„ ','ë‹¬ê±€','ìˆ˜í”„','ë²„í„°','ì†Œê¸ˆ','ì°¨'] },
      { cat:'kolory',     words:['ë¹¨ê°„','íŒŒë€','ì´ˆë¡','ë…¸ë€','ê²€ì€','í•˜ì–€','ë¶„í™','ì£¼í™©','ë³´ë¼','ê°ˆìƒ‰','íšŒìƒ‰','ê¸ˆìƒ‰'] },
      { cat:'rodzina',    words:['ì–´ë¨¸ë‹ˆ','ì•„ë²„ì§€','í˜•','ì˜¤ë¹ ','ì–¸ë‹ˆ','ëˆ„ë‚˜','ë‚¨ë™ìƒ','ì—¬ë™ìƒ','í• ë¨¸ë‹ˆ','í• ì•„ë²„ì§€','ì•„ë“¤','ë”¸'] },
    ],
    medium: [
      { cat:'czasowniki', words:['ë‹¬ë¦¬ë‹¤','ìë‹¤','ë¨¹ë‹¤','ë§ˆì‹œë‹¤','ì“°ë‹¤','ì½ë‹¤','ë§í•˜ë‹¤','ì¼í•˜ë‹¤','ë°°ìš°ë‹¤','ì—¬í–‰í•˜ë‹¤','ì›ƒë‹¤','ìŠë‹¤'] },
      { cat:'przymiotniki',words:['í–‰ë³µí•œ','ìŠ¬í”ˆ','í”¼ê³¤í•œ','ë°°ê³ í”ˆ','ê°•í•œ','ë¹ ë¥¸','ëŠë¦°','ì Šì€','ëŠ™ì€','ì•„ë¦„ë‹¤ìš´','ì‘ì€','í°'] },
    ],
    hard: [
      { cat:'abstrakcja', words:['ììœ ','ì •ì˜','í‰ë“±','ë¯¼ì£¼ì£¼ì˜','ì² í•™','ì•¼ë§','ì„±ì‹¤','íšŒë³µë ¥','ê³µê°','í–¥ìˆ˜','ìš°ìš¸','í–‰ë³µê°'] },
    ],
  },
  uk: {
    easy: [
      { cat:'jedzenie',   words:['Ñ…Ğ»Ñ–Ğ±','Ğ¼Ğ¾Ğ»Ğ¾ĞºĞ¾','ÑĞ¸Ñ€','ÑĞ±Ğ»ÑƒĞºĞ¾','Ğ²Ğ¾Ğ´Ğ°','ĞºĞ°Ğ²Ğ°','Ñ‚Ğ¾Ñ€Ñ‚','Ñ€Ğ¸Ğ±Ğ°','ÑĞ¹Ñ†Ğµ','ÑÑƒĞ¿','Ğ¼Ğ°ÑĞ»Ğ¾','ÑÑ–Ğ»ÑŒ'] },
      { cat:'kolory',     words:['Ñ‡ĞµÑ€Ğ²Ğ¾Ğ½Ğ¸Ğ¹','ÑĞ¸Ğ½Ñ–Ğ¹','Ğ·ĞµĞ»ĞµĞ½Ğ¸Ğ¹','Ğ¶Ğ¾Ğ²Ñ‚Ğ¸Ğ¹','Ñ‡Ğ¾Ñ€Ğ½Ğ¸Ğ¹','Ğ±Ñ–Ğ»Ğ¸Ğ¹','Ñ€Ğ¾Ğ¶ĞµĞ²Ğ¸Ğ¹','Ğ¿Ğ¾Ğ¼Ğ°Ñ€Ğ°Ğ½Ñ‡ĞµĞ²Ğ¸Ğ¹','Ñ„Ñ–Ğ¾Ğ»ĞµÑ‚Ğ¾Ğ²Ğ¸Ğ¹','ĞºĞ¾Ñ€Ğ¸Ñ‡Ğ½ĞµĞ²Ğ¸Ğ¹','ÑÑ–Ñ€Ğ¸Ğ¹','Ğ·Ğ¾Ğ»Ğ¾Ñ‚Ğ¸Ğ¹'] },
      { cat:'rodzina',    words:['Ğ¼Ğ°Ñ‚Ğ¸','Ğ±Ğ°Ñ‚ÑŒĞºĞ¾','Ğ±Ñ€Ğ°Ñ‚','ÑĞµÑÑ‚Ñ€Ğ°','Ğ±Ğ°Ğ±ÑƒÑÑ','Ğ´Ñ–Ğ´ÑƒÑÑŒ','ÑĞ¸Ğ½','Ğ´Ğ¾Ñ‡ĞºĞ°','Ğ´Ğ¸Ñ‚Ğ¸Ğ½Ğ°','Ñ‡Ğ¾Ğ»Ğ¾Ğ²Ñ–Ğº','Ğ´Ñ€ÑƒĞ¶Ğ¸Ğ½Ğ°','Ñ€Ğ¾Ğ´Ğ¸Ğ½Ğ°'] },
    ],
    medium: [
      { cat:'czasowniki', words:['Ğ±Ñ–Ğ³Ñ‚Ğ¸','ÑĞ¿Ğ°Ñ‚Ğ¸','Ñ—ÑÑ‚Ğ¸','Ğ¿Ğ¸Ñ‚Ğ¸','Ğ¿Ğ¸ÑĞ°Ñ‚Ğ¸','Ñ‡Ğ¸Ñ‚Ğ°Ñ‚Ğ¸','Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ¸Ñ‚Ğ¸','Ğ¿Ñ€Ğ°Ñ†ÑĞ²Ğ°Ñ‚Ğ¸','Ğ²Ñ‡Ğ¸Ñ‚Ğ¸ÑÑ','Ğ¿Ğ¾Ğ´Ğ¾Ñ€Ğ¾Ğ¶ÑƒĞ²Ğ°Ñ‚Ğ¸','ÑĞ¼Ñ–ÑÑ‚Ğ¸ÑÑ','Ğ·Ğ°Ğ±ÑƒĞ²Ğ°Ñ‚Ğ¸'] },
      { cat:'przymiotniki',words:['Ñ‰Ğ°ÑĞ»Ğ¸Ğ²Ğ¸Ğ¹','ÑÑƒĞ¼Ğ½Ğ¸Ğ¹','Ğ²Ñ‚Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹','Ğ³Ğ¾Ğ»Ğ¾Ğ´Ğ½Ğ¸Ğ¹','ÑĞ¸Ğ»ÑŒĞ½Ğ¸Ğ¹','ÑˆĞ²Ğ¸Ğ´ĞºĞ¸Ğ¹','Ğ¿Ğ¾Ğ²Ñ–Ğ»ÑŒĞ½Ğ¸Ğ¹','Ğ¼Ğ¾Ğ»Ğ¾Ğ´Ğ¸Ğ¹','ÑÑ‚Ğ°Ñ€Ğ¸Ğ¹','ĞºÑ€Ğ°ÑĞ¸Ğ²Ğ¸Ğ¹','Ğ¼Ğ°Ğ»Ğ¸Ğ¹','Ğ²ĞµĞ»Ğ¸ĞºĞ¸Ğ¹'] },
    ],
    hard: [
      { cat:'abstrakcja', words:['ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ğ°','ÑĞ¿Ñ€Ğ°Ğ²ĞµĞ´Ğ»Ğ¸Ğ²Ñ–ÑÑ‚ÑŒ','Ñ€Ñ–Ğ²Ğ½Ñ–ÑÑ‚ÑŒ','Ğ´ĞµĞ¼Ğ¾ĞºÑ€Ğ°Ñ‚Ñ–Ñ','Ñ„Ñ–Ğ»Ğ¾ÑĞ¾Ñ„Ñ–Ñ','Ğ°Ğ¼Ğ±Ñ–Ñ†Ñ–Ñ','Ñ‡ĞµÑĞ½Ñ–ÑÑ‚ÑŒ','ÑÑ‚Ñ–Ğ¹ĞºÑ–ÑÑ‚ÑŒ','ÑĞ¿Ñ–Ğ²Ñ‡ÑƒÑ‚Ñ‚Ñ','Ğ½Ğ¾ÑÑ‚Ğ°Ğ»ÑŒĞ³Ñ–Ñ','Ğ¼ĞµĞ»Ğ°Ğ½Ñ…Ğ¾Ğ»Ñ–Ñ','ĞµĞ¹Ñ„Ğ¾Ñ€Ñ–Ñ'] },
    ],
  },
  cs: {
    easy: [
      { cat:'jedzenie',   words:['chlÃ©b','mlÃ©ko','sÃ½r','jablko','voda','kÃ¡va','dort','ryba','vejce','polÃ©vka','mÃ¡slo','sÅ¯l'] },
      { cat:'kolory',     words:['ÄervenÃ½','modrÃ½','zelenÃ½','Å¾lutÃ½','ÄernÃ½','bÃ­lÃ½','rÅ¯Å¾ovÃ½','oranÅ¾ovÃ½','fialovÃ½','hnÄ›dÃ½','Å¡edÃ½','zlatÃ½'] },
      { cat:'rodzina',    words:['matka','otec','bratr','sestra','babiÄka','dÄ›deÄek','syn','dcera','dÃ­tÄ›','manÅ¾el','manÅ¾elka','rodina'] },
    ],
    medium: [
      { cat:'czasowniki', words:['bÄ›Å¾et','spÃ¡t','jÃ­st','pÃ­t','psÃ¡t','ÄÃ­st','mluvit','pracovat','uÄit se','cestovat','smÃ¡t se','zapomenout'] },
      { cat:'przymiotniki',words:['Å¡Å¥astnÃ½','smutnÃ½','unavenÃ½','hladovÃ½','silnÃ½','rychlÃ½','pomalÃ½','mladÃ½','starÃ½','krÃ¡snÃ½','malÃ½','velkÃ½'] },
    ],
    hard: [
      { cat:'abstrakcja', words:['svoboda','spravedlnost','rovnost','demokracie','filozofie','ambice','integrita','odolnost','empatie','nostalgie','melancholie','euforie'] },
    ],
  },
};

const LANGUAGES = [
  { code:'en', name:'Angielski',   flag:'ğŸ‡¬ğŸ‡§' },
  { code:'de', name:'Niemiecki',   flag:'ğŸ‡©ğŸ‡ª' },
  { code:'es', name:'HiszpaÅ„ski',  flag:'ğŸ‡ªğŸ‡¸' },
  { code:'fr', name:'Francuski',   flag:'ğŸ‡«ğŸ‡·' },
  { code:'it', name:'WÅ‚oski',      flag:'ğŸ‡®ğŸ‡¹' },
  { code:'pt', name:'Portugalski', flag:'ğŸ‡µğŸ‡¹' },
  { code:'ru', name:'Rosyjski',    flag:'ğŸ‡·ğŸ‡º' },
  { code:'ja', name:'JapoÅ„ski',    flag:'ğŸ‡¯ğŸ‡µ' },
  { code:'zh', name:'ChiÅ„ski',     flag:'ğŸ‡¨ğŸ‡³' },
  { code:'ko', name:'KoreaÅ„ski',   flag:'ğŸ‡°ğŸ‡·' },
  { code:'uk', name:'UkraiÅ„ski',   flag:'ğŸ‡ºğŸ‡¦' },
  { code:'cs', name:'Czeski',      flag:'ğŸ‡¨ğŸ‡¿' },
];

// MyMemory language codes
const MM_CODES = { en:'en-GB', de:'de-DE', es:'es-ES', fr:'fr-FR', it:'it-IT',
                   pt:'pt-PT', ru:'ru-RU', ja:'ja-JP', zh:'zh-CN', ko:'ko-KR',
                   uk:'uk-UA', cs:'cs-CZ' };

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let selectedLang = null;
let difficulty   = 'easy';
let score        = { correct:0, total:0 };
let streak       = 0;
let answered     = false;
let usedWords    = [];
let scoreHistory = [];
let dotTimer     = null;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  BUILD UI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildLangGrid() {
  const grid = document.getElementById('lang-grid');
  LANGUAGES.forEach(lang => {
    const btn = document.createElement('button');
    btn.className = 'lang-btn';
    btn.innerHTML = `<span class="lang-flag">${lang.flag}</span><span>${lang.name}</span>`;
    btn.onclick = () => {
      selectedLang = lang;
      document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('selected'));
      btn.classList.add('selected');
      document.getElementById('start-btn').disabled = false;
    };
    grid.appendChild(btn);
  });
}
buildLangGrid();

function setDiff(btn) {
  difficulty = btn.dataset.diff;
  document.querySelectorAll('.diff-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SCREENS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function startQuiz() {
  if (!selectedLang) return;
  score = { correct:0, total:0 };
  streak = 0; usedWords = []; scoreHistory = [];
  document.getElementById('lang-screen').style.display  = 'none';
  document.getElementById('quiz-screen').style.display  = 'block';
  document.getElementById('quiz-lang-label').textContent = selectedLang.flag + ' ' + selectedLang.name;
  document.getElementById('quiz-diff-label').textContent = {easy:'ÅATWY',medium:'ÅšREDNI',hard:'TRUDNY'}[difficulty];
  buildScoreBar();
  loadQuestion();
}

function goBack() {
  clearInterval(dotTimer);
  document.getElementById('quiz-screen').style.display = 'none';
  document.getElementById('lang-screen').style.display = 'block';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SCORE BAR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SEG = 10;
function buildScoreBar() {
  const bar = document.getElementById('score-bar');
  bar.querySelectorAll('.score-seg').forEach(s => s.remove());
  const lbl = document.getElementById('score-label');
  for (let i = 0; i < SEG; i++) {
    const s = document.createElement('div');
    s.className = 'score-seg';
    bar.insertBefore(s, lbl);
  }
  refreshScoreBar();
}
function refreshScoreBar() {
  document.querySelectorAll('.score-seg').forEach((seg, i) => {
    seg.className = 'score-seg';
    const h = scoreHistory[scoreHistory.length - SEG + i];
    if (h === true)  seg.classList.add('correct');
    if (h === false) seg.classList.add('wrong');
  });
  document.getElementById('score-label').textContent = score.correct + ' / ' + score.total;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DOTS ANIMATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function startDots() {
  let n = 0;
  clearInterval(dotTimer);
  dotTimer = setInterval(() => {
    const el = document.getElementById('load-dots');
    if (el) el.textContent = '.'.repeat((n++ % 3) + 1);
  }, 350);
}
function stopDots() { clearInterval(dotTimer); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PICK WORD FROM DB
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function pickWord() {
  const db = WORD_DB[selectedLang.code];
  // fallback to easy if no pool for this difficulty
  const pool = db[difficulty] || db['easy'];

  // pick a random category, then a random word not recently used
  let attempts = 0;
  while (attempts++ < 50) {
    const cat = pool[Math.floor(Math.random() * pool.length)];
    const word = cat.words[Math.floor(Math.random() * cat.words.length)];
    if (!usedWords.includes(word)) {
      return { word, cat: cat.cat, pool };
    }
  }
  // all used â€” reset and pick again
  usedWords = [];
  const cat = pool[Math.floor(Math.random() * pool.length)];
  const word = cat.words[Math.floor(Math.random() * cat.words.length)];
  return { word, cat: cat.cat, pool };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TRANSLATE via MyMemory
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function translate(word, fromCode) {
  const from = MM_CODES[fromCode] || fromCode;
  const url  = `https://api.mymemory.translated.net/get?q=${encodeURIComponent(word)}&langpair=${from}|pl-PL`;
  const res  = await fetch(url);
  const data = await res.json();
  if (data.responseStatus !== 200) throw new Error('BÅ‚Ä…d tÅ‚umaczenia: ' + data.responseMessage);
  let t = data.responseData.translatedText;
  // MyMemory sometimes returns ALL CAPS for short words â€” normalize
  if (t === t.toUpperCase() && t.length > 2) t = t.charAt(0).toUpperCase() + t.slice(1).toLowerCase();
  return t;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  GENERATE DISTRACTORS
//  Translate 3 other random words from same/different cats
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function getDistractors(pool, excludeWord, correctTranslation) {
  // collect candidate words from pool, excluding the correct word
  let candidates = [];
  for (const cat of pool) {
    for (const w of cat.words) {
      if (w !== excludeWord) candidates.push(w);
    }
  }
  shuffle(candidates);
  candidates = candidates.slice(0, 8); // translate up to 8, pick first 3 that differ

  const translations = [];
  for (const cand of candidates) {
    if (translations.length >= 3) break;
    try {
      const t = await translate(cand, selectedLang.code);
      // avoid duplicating the correct answer or each other
      const normalized = t.toLowerCase().trim();
      const isDupe = normalized === correctTranslation.toLowerCase().trim() ||
                     translations.some(x => x.toLowerCase().trim() === normalized);
      if (!isDupe && t.length > 0) translations.push(t);
    } catch(_) { /* skip failed */ }
  }

  // pad with generic fallbacks if we couldn't get 3
  const fallbacks = ['nieznane','coÅ› innego','inne sÅ‚owo','brak tÅ‚umaczenia'];
  while (translations.length < 3) {
    const fb = fallbacks[translations.length];
    if (!translations.includes(fb)) translations.push(fb);
    else translations.push('???');
  }
  return translations;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  LOAD QUESTION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadQuestion() {
  answered = false;
  document.getElementById('err-box').className   = 'err-box';
  document.getElementById('feedback').className  = 'feedback';
  document.getElementById('next-btn').className  = 'next-btn';
  document.getElementById('streak-badge').className = 'streak-badge';
  document.getElementById('answers').innerHTML   = '';
  document.getElementById('word-card').innerHTML =
    `<div class="word-loading">TÅ‚umaczÄ™<span id="load-dots">.</span></div>`;
  startDots();

  try {
    const { word, cat, pool } = pickWord();
    usedWords.push(word);

    // Translate correct word
    const correctPl = await translate(word, selectedLang.code);

    // Get 3 distractors
    const wrongs = await getDistractors(pool, word, correctPl);

    stopDots();
    renderQuestion({ word, cat, correct: correctPl, wrong: wrongs });

  } catch(err) {
    stopDots();
    document.getElementById('word-card').innerHTML =
      `<div class="word-loading" style="color:#e74c3c">BÅ‚Ä…d Å‚adowania</div>`;
    const errEl = document.getElementById('err-box');
    errEl.textContent = 'âš  ' + err.message;
    errEl.className = 'err-box show';
    document.getElementById('next-btn').className = 'next-btn show';
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  RENDER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderQuestion({ word, cat, correct, wrong }) {
  document.getElementById('word-card').innerHTML = `
    <div class="word-lang-tag">${selectedLang.flag} ${selectedLang.name}</div>
    <div class="word-category">${cat}</div>
    <div class="word-main">${word}</div>
  `;

  const options = shuffle([
    { text: correct, correct: true },
    { text: wrong[0], correct: false },
    { text: wrong[1], correct: false },
    { text: wrong[2], correct: false },
  ]);

  const letters = ['A','B','C','D'];
  const container = document.getElementById('answers');
  container.innerHTML = '';
  options.forEach((opt, i) => {
    const btn = document.createElement('button');
    btn.className = 'ans-btn';
    btn.innerHTML = `<span class="ans-letter">${letters[i]}</span><span>${opt.text}</span>`;
    btn.onclick = () => onAnswer(opt.correct, btn, correct);
    container.appendChild(btn);
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ANSWER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function onAnswer(isCorrect, clickedBtn, correctText) {
  if (answered) return;
  answered = true;
  score.total++;

  document.querySelectorAll('.ans-btn').forEach(b => { b.disabled = true; });
  const fb = document.getElementById('feedback');

  if (isCorrect) {
    score.correct++;
    streak++;
    clickedBtn.classList.add('correct');
    fb.textContent = streak >= 3 ? `âœ“ Åšwietnie! Seria: ${streak} ğŸ”¥` : 'âœ“ Poprawnie!';
    fb.className = 'feedback show ok';
  } else {
    streak = 0;
    clickedBtn.classList.add('wrong');
    document.querySelectorAll('.ans-btn').forEach(b => {
      if (b.querySelectorAll('span')[1]?.textContent === correctText) b.classList.add('reveal');
    });
    fb.textContent = `âœ— BÅ‚Ä…d. Poprawna: ${correctText}`;
    fb.className = 'feedback show fail';
  }

  scoreHistory.push(isCorrect);
  refreshScoreBar();

  if (streak >= 3) {
    const badge = document.getElementById('streak-badge');
    badge.textContent = `ğŸ”¥ Seria ${streak} poprawnych z rzÄ™du!`;
    badge.className = 'streak-badge show';
  }

  document.getElementById('next-btn').className = 'next-btn show';
}

function nextQuestion() { loadQuestion(); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  UTILS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}
</script>
</body>
</html>